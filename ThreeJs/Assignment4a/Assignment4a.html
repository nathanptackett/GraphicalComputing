<!DOCTYPE html>
<html>
   <head>
      <title>Assignment 4</title>
      <script  src="https://threejs.org/build/three.js"></script>
      <script src="https://threejs.org/examples/js/renderers/CanvasRenderer.js"></script>
      <script  src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>

      <script id="vertexShader" type="x-shader/x-vertex">
         precision highp float;

         attribute vec3 position;
         attribute vec2 uv;
         varying vec2 vUV;

         attribute vec3 normal;
         varying vec3 vNormal;

         uniform mat4 modelViewMatrix;
         uniform mat4 projectionMatrix;
         varying vec4 vPosition;
         uniform mat3 normalMatrix;

         void main() {
            vUV = uv;
            vNormal = normalize(normal);
            gl_Position = projectionMatrix*modelViewMatrix*vec4(position, 1.0);
            vPosition = gl_Position;
         }
      </script>

      <script id="fragmentShader" type="x-shader/x-fragment">
         precision highp float;

         uniform float light_intensity;
         uniform vec3 light_color;
         uniform vec3 light_position;
         uniform vec3 material_color;
         uniform sampler2D texture;
         varying vec3 vNormal;
         varying vec2 vUV;
         varying vec4 vPosition;

         void main() {
            vec4 color = texture2D(texture, vUV);
            vec3 vector_to_light_position = vec3( vPosition.x - light_position.x, vPosition.y - light_position.y, vPosition.z - light_position.z);
            vector_to_light_position = normalize(vector_to_light_position);

            float cos_of_angle_between = dot(vNormal, vector_to_light_position);

            gl_FragColor = color*cos_of_angle_between;
         }
      </script>

      <script>
         // Add your own Javascript code/methods here.
         var light;
         function mainFunction()
         {
            let renderer = new THREE.WebGLRenderer( { antialias: true } );
            renderer.setSize( window.innerWidth, window.innerHeight );
            renderer.setPixelRatio( window.devicePixelRatio );

            renderer.setClearColor (0xD3D3D3, 1);
            document.body.appendChild( renderer.domElement );

            let scene = new THREE.Scene();

            let aspect = window.innerWidth / window.innerHeight;
            let camera = new THREE.PerspectiveCamera( 30, aspect, 1, 1000 );
            camera.position.z = 20;
            scene.add(camera);
            let cameraControls = new THREE.OrbitControls(camera, renderer.domElement);
            
            let light_intensity = 1;
            let light_position = [1, 1, 1];
             light = new THREE.PointLight(0xFFFFFF, light_intensity, 100);
            light.position.set(light_position[0], light_position[1], light_position[2]);
            scene.add( light );

            let sphereSize = 0.05;
            let pointLightHelper = new THREE.PointLightHelper(light, sphereSize);
            scene.add(pointLightHelper);

            //Add plane
            let planeGeometry = new THREE.PlaneGeometry(6, 6);

            let texture = new THREE.TextureLoader().load("tableTop.jpg");

            let my_material = new THREE.RawShaderMaterial({
               side: THREE.DoubleSide,
               fragmentShader: document.getElementById('fragmentShader').textContent,
               vertexShader: document.getElementById('vertexShader').textContent,
               uniforms: {
                  light_intensity: { type: "float", value: light_intensity},
                  light_color: { type: "vec3", value: [1, 1, 1]},
                  light_position: { type: "vec3", value: light_position},
                  material_color: {type: "vec3", value: [119.0/255.0, 119.0/255.0, 255.0/255.0]},
                  texture: {type: "t", value: texture}
               }
            });

            var from = new THREE.Vector3( -1, -1, 0 );
            var to = new THREE.Vector3( light.position.x, light.position.y, light.position.z );
            var direction = to.clone().sub(from);
            var vec_length = direction.length();
            var arrowHelper1 = new THREE.ArrowHelper(direction.normalize(), from, 1, 0xff0000 );
            scene.add( arrowHelper1 );

            from = new THREE.Vector3( -1, -1, 0 );
            to = new THREE.Vector3( -1, -1, light.position.z );
            direction = to.clone().sub(from);
            vec_length = direction.length();
            arrowHelper2 = new THREE.ArrowHelper(direction.normalize(), from, 1, 0xff0000 );
            scene.add( arrowHelper2 );

            // let sphere = new THREE.Mesh(sphereGeometry, provided_material);
            let plane = new THREE.Mesh(planeGeometry, my_material);
            scene.add(plane);
            
            //Handle Resize of window
            let resize = function () {
               renderer.setSize(window.innerWidth, window.innerHeight);
               camera.aspect = window.innerWidth / window.innerHeight;
               camera.updateProjectionMatrix();
            };

            window.addEventListener("resize",resize, false)

            //render function
            let render = function () {
               requestAnimationFrame( render );
               renderer.render( scene, camera );
            };


            render();
         }
      </script>
   </head>
   
   <body onload="mainFunction();">
         <h1>--Nathan Tackett 4421778--</h1>
   </body>
   
</html>
